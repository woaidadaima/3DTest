<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Three.js全景图查看器</title>
  <style>
    html,
    body {
      margin: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    #c {
      width: 100%;
      height: 100%;
      display: block;
    }

    #lineName {
      display: block;
      color: black;
      font-weight: 700;
      font-size: 128px;
      font-family: Arial, sans-serif;
      user-select: none;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <canvas id="c"></canvas>
  <div id="lineName">张丰666线</div>
</body>
<!-- 引入Three.js核心库 -->
<script type="importmap">
    {
      "imports": {
        "three": "./three/build/three.module.js",
        "three/addons/": "./three/examples/jsm/",
        "@tweenjs/tween.js": "./tween.js-main/dist/tween.esm.js"
      }
    }
  </script>
<script type="module">
  import * as THREE from "three";
  import * as TWEEN from "@tweenjs/tween.js";
  import {
    LineModel,
    MarkModel,
    SceneControl,
    PointModel
  } from "./threeDemoJs/index.js"

  // 初始化场景控制器
  const sceneController = new SceneControl({
    camera: {
      fov: 80,
      near: 0.1,
      far: 20000,
      position: { x: 6000, y: 6000, z: 6000 }
    }
  });

  //创建场景一标记点
  const tagContainer = document.createElement("canvas");
  const markModelConfig = {
    SphereGeometry: {
      geometry: {
        radius: 5,
        widthSegments: 16,
        heightSegments: 16,
      },
      material: {
        color: 0xff0000,
      },
      position: [
        300,
        -172,
        -337,
      ],
      name: "T1",
      animation: {
        axis: "y",
        duration: 2,
        maxDistance: 10
      }
    },
    CircleGeometry: {
      geometry: {
        radius: 5,
        segments: 32,
      },
      material: {
        color: 0xffffff,
        transparent: true,
        side: THREE.DoubleSide
      },
      name: "circle",
      animation: {
        duration: 2,
        maxRadiusRatio: 4,
        initXYZ: [1, 1, 1],
      }
    }
  }
  const markTagConfig = {
    domContainer: tagContainer,
    scale: [40, 20, 5],
    style: {
      width: 256,
      height: 128,
      pixelRatio: window.devicePixelRatio || 1,
      textColor: "white",
      background: "rgba(0, 0, 0, 0.5)",
      fontStyle: "bold 90px Arial",
      textAlign: "center",
      textBaseline: "middle",
      text: "T1",
    }
  }
  const markInstance = new MarkModel(markModelConfig, markTagConfig)

  //创建场景一线标签容器
  const lineNameLabel = document.getElementById("lineName");
  const lineInstance = new LineModel({
    basicMaterial: {
      color: "#00FF41", // 更鲜艳的绿色
      linewidth: "100", // 增加线条粗细
      transparent: true,
      opacity: 0.9
    },
    dataSource: [
      [- 1128, 414, -2748],
      [570, 445, -2911],
      [1868, 376, -2314],
    ]
  }, {
    domId: lineNameLabel
  })

  //创建场景一随机标记点
  const pointInstance = new PointModel()
  console.log("🚀 ~ pointInstance:", pointInstance)

  //创建场景2标记点
  const tagContainerScene2 = document.createElement("canvas");
  const markModelConfigScene2 = {
    SphereGeometry: {
      geometry: {
        radius: 5,
        widthSegments: 16,
        heightSegments: 16,
      },
      material: {
        color: 0x00ff00,
      },
      position: [
        -150,
        50,
        400,
      ],
      name: "T2",
      animation: {
        axis: "y",
        duration: 2,
        maxDistance: 10
      }
    },
    CircleGeometry: {
      geometry: {
        radius: 5,
        segments: 32,
      },
      material: {
        color: 0xffffff,
        transparent: true,
        side: THREE.DoubleSide
      },
      name: "circle",
      animation: {
        duration: 2,
        maxRadiusRatio: 4,
        initXYZ: [1, 1, 1],
      }
    }
  }
  const markTagConfigScene2 = {
    domContainer: tagContainerScene2,
    scale: [40, 20, 5],
    style: {
      width: 256,
      height: 128,
      pixelRatio: window.devicePixelRatio || 1,
      textColor: "white",
      background: "rgba(0, 0, 0, 0.5)",
      fontStyle: "bold 90px Arial",
      textAlign: "center",
      textBaseline: "middle",
      text: "T2",
    }
  }
  const markInstanceScene2 = new MarkModel(markModelConfigScene2, markTagConfigScene2)

  // 添加场景配置
  sceneController.addScene('scene1', {
    texture: "./images/DJI_20250228152043_0001_V.JPG",
    markers: markInstance.marksGroup,
    points: pointInstance.points,
    lines: lineInstance.group,
    css3D: true
  });

  sceneController.addScene('scene2', {
    texture: "./images/HMSH全景_00635_.png",
    markers: markInstanceScene2.marksGroup,
    lines: null,
    css3D: false
  });

  // 添加动画混合器
  sceneController.addAnimationMixer(markInstance.mixer);
  sceneController.addAnimationMixer(markInstanceScene2.mixer);
  // 加载初始场景
  sceneController.loadInitialScene('scene1', "./images/DJI_20250228152043_0001_V.JPG");

  // 添加相机入场动画
  sceneController.animateCamera({ x: 0, y: 0, z: 100 }, 6000);

  // 开始动画循环
  sceneController.startAnimation();
</script>

</html>